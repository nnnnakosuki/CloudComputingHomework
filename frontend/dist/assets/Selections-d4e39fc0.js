import{r as S,b as B,k as Z,c as o,v as ee,o as f,d as te,f as t,w as a,E as r,e as b,g as T,h as d,t as N,x as ne,n as v,m as k,p as C}from"./index-9b5da449.js";import{a as ae,b as V,e as R}from"./courseSelection-a3ee75e2.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";const oe={class:"selection-audit"},se={class:"batch-actions"},ce={class:"pagination"},re={__name:"Selections",setup(ie){const w=S(!1),z=S([]),p=S([]),s=B({current:1,size:10,total:0}),i=B({studentName:"",courseName:"",status:null}),u=async()=>{w.value=!0;try{const n=await ae({current:s.current,size:s.size,...i});z.value=n.data.records||[],s.total=n.data.total||0}catch{r.error("获取选课记录失败")}finally{w.value=!1}},g=()=>{s.current=1,u()},$=()=>{Object.assign(i,{studentName:"",courseName:"",status:null}),g()},j=n=>{p.value=n},U=async n=>{try{await C.confirm(`确定要确认学生"${n.studentName}"的选课申请吗？`,"确认选课",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await V([n.id]),r.success("确认成功"),u()}catch(e){e!=="cancel"&&r.error("确认失败")}},E=async n=>{try{await C.confirm(`确定要拒绝学生"${n.studentName}"的选课申请吗？`,"拒绝选课",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await R([n.id]),r.success("拒绝成功"),u()}catch(e){e!=="cancel"&&r.error("拒绝失败")}},D=async()=>{const n=p.value.filter(e=>e.status===1);if(n.length===0){r.warning("没有待确认的选课记录");return}try{await C.confirm(`确定要批量确认 ${n.length} 个选课申请吗？`,"批量确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=n.map(_=>_.id);await V(e),r.success("批量确认成功"),u()}catch(e){e!=="cancel"&&r.error("批量确认失败")}},I=async()=>{const n=p.value.filter(e=>e.status===1);if(n.length===0){r.warning("没有待确认的选课记录");return}try{await C.confirm(`确定要批量拒绝 ${n.length} 个选课申请吗？`,"批量拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=n.map(_=>_.id);await R(e),r.success("批量拒绝成功"),u()}catch(e){e!=="cancel"&&r.error("批量拒绝失败")}},K=n=>{s.size=n,u()},L=n=>{s.current=n,u()},M=n=>{switch(n){case 1:return"warning";case 2:return"success";case 3:return"danger";default:return"info"}};return Z(()=>{u()}),(n,e)=>{const _=o("el-input"),h=o("el-form-item"),x=o("el-option"),F=o("el-select"),O=o("Search"),y=o("el-icon"),m=o("el-button"),P=o("Refresh"),q=o("el-form"),A=o("Check"),G=o("Close"),c=o("el-table-column"),H=o("el-tag"),J=o("el-table"),Q=o("el-pagination"),W=o("el-card"),X=ee("loading");return f(),te("div",oe,[t(W,null,{header:a(()=>[...e[5]||(e[5]=[b("div",{class:"card-header"},[b("span",null,"选课审核")],-1)])]),default:a(()=>[t(q,{model:i,inline:"",class:"search-form"},{default:a(()=>[t(h,{label:"学生姓名"},{default:a(()=>[t(_,{modelValue:i.studentName,"onUpdate:modelValue":e[0]||(e[0]=l=>i.studentName=l),placeholder:"请输入学生姓名",clearable:"",onKeyup:T(g,["enter"])},null,8,["modelValue"])]),_:1}),t(h,{label:"课程名称"},{default:a(()=>[t(_,{modelValue:i.courseName,"onUpdate:modelValue":e[1]||(e[1]=l=>i.courseName=l),placeholder:"请输入课程名称",clearable:"",onKeyup:T(g,["enter"])},null,8,["modelValue"])]),_:1}),t(h,{label:"审核状态"},{default:a(()=>[t(F,{modelValue:i.status,"onUpdate:modelValue":e[2]||(e[2]=l=>i.status=l),placeholder:"请选择审核状态",clearable:""},{default:a(()=>[t(x,{label:"待确认",value:1}),t(x,{label:"已确认",value:2}),t(x,{label:"已退课",value:3})]),_:1},8,["modelValue"])]),_:1}),t(h,null,{default:a(()=>[t(m,{type:"primary",onClick:g},{default:a(()=>[t(y,null,{default:a(()=>[t(O)]),_:1}),e[6]||(e[6]=d(" 搜索 ",-1))]),_:1}),t(m,{onClick:$},{default:a(()=>[t(y,null,{default:a(()=>[t(P)]),_:1}),e[7]||(e[7]=d(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),b("div",se,[t(m,{type:"success",onClick:D,disabled:p.value.length===0},{default:a(()=>[t(y,null,{default:a(()=>[t(A)]),_:1}),d(" 批量确认 ("+N(p.value.length)+") ",1)]),_:1},8,["disabled"]),t(m,{type:"danger",onClick:I,disabled:p.value.length===0},{default:a(()=>[t(y,null,{default:a(()=>[t(G)]),_:1}),d(" 批量拒绝 ("+N(p.value.length)+") ",1)]),_:1},8,["disabled"])]),ne((f(),v(J,{data:z.value,stripe:"",style:{width:"100%"},onSelectionChange:j},{default:a(()=>[t(c,{type:"selection",width:"55"}),t(c,{prop:"studentNo",label:"学号",width:"120"}),t(c,{prop:"studentName",label:"学生姓名",width:"100"}),t(c,{prop:"courseCode",label:"课程编号",width:"120"}),t(c,{prop:"courseName",label:"课程名称",width:"150"}),t(c,{prop:"credits",label:"学分",width:"80"}),t(c,{prop:"semester",label:"学期",width:"120"}),t(c,{prop:"teacherName",label:"任课教师",width:"100"}),t(c,{prop:"statusText",label:"状态",width:"100"},{default:a(({row:l})=>[t(H,{type:M(l.status)},{default:a(()=>[d(N(l.statusText),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"selectTime",label:"选课时间",width:"160"}),t(c,{label:"操作",width:"150",fixed:"right"},{default:a(({row:l})=>[l.status===1?(f(),v(m,{key:0,type:"success",size:"small",onClick:Y=>U(l)},{default:a(()=>[...e[8]||(e[8]=[d(" 确认 ",-1)])]),_:1},8,["onClick"])):k("",!0),l.status===1?(f(),v(m,{key:1,type:"danger",size:"small",onClick:Y=>E(l)},{default:a(()=>[...e[9]||(e[9]=[d(" 拒绝 ",-1)])]),_:1},8,["onClick"])):k("",!0),l.status!==1?(f(),v(m,{key:2,type:"info",size:"small",disabled:""},{default:a(()=>[...e[10]||(e[10]=[d(" 已处理 ",-1)])]),_:1})):k("",!0)]),_:1})]),_:1},8,["data"])),[[X,w.value]]),b("div",ce,[t(Q,{"current-page":s.current,"onUpdate:currentPage":e[3]||(e[3]=l=>s.current=l),"page-size":s.size,"onUpdate:pageSize":e[4]||(e[4]=l=>s.size=l),total:s.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:K,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1})])}}},me=le(re,[["__scopeId","data-v-1562a691"]]);export{me as default};
