import{r as g,b as T,j as ie,k as ce,c as o,v as pe,o as C,d as j,f as e,w as t,E as m,e as U,h as c,g as me,x as _e,n as q,t as V,F as fe,q as ge,p as D}from"./index-9b5da449.js";import{a as ve,d as be,c as he,u as ye,p as we}from"./courseSchedule-2f0830e1.js";import{g as Ce}from"./course-935a4045.js";import{_ as Ve}from"./_plugin-vue_export-helper-c27b6911.js";const Se={class:"course-schedule-management"},xe={class:"card-header"},ke={class:"pagination"},Ie={__name:"Schedules",setup(ze){const S=g(!1),x=g(!1),v=g(!1),h=g(!1),B=g([]),k=g([]),u=T({current:1,size:10,total:0}),d=T({keyword:"",semester:"",teacherId:null,status:null}),r=T({id:null,courseId:null,semester:"",teacherId:null,maxStudents:null}),F={courseId:[{required:!0,message:"请选择课程",trigger:"change"}],semester:[{required:!0,message:"请选择学期",trigger:"change"}],teacherId:[{required:!0,message:"请选择任课教师",trigger:"change"}],maxStudents:[{required:!0,message:"请输入最大选课人数",trigger:"blur"}]},M=ie(()=>h.value?"编辑开课计划":"发布开课计划"),f=async()=>{S.value=!0;try{const s=await ve({current:u.current,size:u.size,...d});B.value=s.data.records,u.total=s.data.total}catch{m.error("获取开课计划列表失败")}finally{S.value=!1}},O=async()=>{try{const s=await Ce();k.value=s.data}catch{m.error("获取课程列表失败")}},I=()=>{u.current=1,f()},P=()=>{Object.assign(d,{keyword:"",semester:"",teacherId:null,status:null}),I()},A=()=>{h.value=!1,L(),v.value=!0},K=s=>{h.value=!0,Object.assign(r,s),v.value=!0},G=async s=>{try{await D.confirm("确定要删除该开课计划吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await be(s.id),m.success("删除成功"),f()}catch(l){l!=="cancel"&&m.error("删除失败")}},H=async s=>{const l=s.status===1?2:1,y=l===1?"开放选课":"结束选课";try{await D.confirm(`确定要${y}该开课计划吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await he(s.id,l),m.success(`${y}成功`),f()}catch(w){w!=="cancel"&&m.error(`${y}失败`)}},J=s=>{k.value.find(l=>l.id===s)},z=g(),Q=async()=>{z.value&&await z.value.validate(async s=>{if(s){x.value=!0;try{h.value?(await ye(r.id,r),m.success("更新成功")):(await we(r),m.success("发布成功")),v.value=!1,f()}catch(l){m.error(l.message||"操作失败")}finally{x.value=!1}}})},W=()=>{L()},L=()=>{Object.assign(r,{id:null,courseId:null,semester:"",teacherId:null,maxStudents:null})},X=s=>{u.size=s,f()},Y=s=>{u.current=s,f()},Z=s=>{switch(s){case 1:return"success";case 2:return"warning";case 0:return"danger";default:return""}};return ce(()=>{f(),O()}),(s,l)=>{const y=o("Plus"),w=o("el-icon"),_=o("el-button"),ee=o("el-input"),p=o("el-form-item"),n=o("el-option"),b=o("el-select"),le=o("Search"),te=o("Refresh"),$=o("el-form"),i=o("el-table-column"),E=o("el-tag"),ae=o("el-table"),se=o("el-pagination"),oe=o("el-card"),N=o("el-col"),ne=o("el-row"),re=o("el-input-number"),ue=o("el-dialog"),de=pe("loading");return C(),j("div",Se,[e(oe,null,{header:t(()=>[U("div",xe,[l[13]||(l[13]=U("span",null,"开课计划管理",-1)),e(_,{type:"primary",onClick:A},{default:t(()=>[e(w,null,{default:t(()=>[e(y)]),_:1}),l[12]||(l[12]=c(" 发布开课计划 ",-1))]),_:1})])]),default:t(()=>[e($,{model:d,inline:"",class:"search-form"},{default:t(()=>[e(p,{label:"关键词"},{default:t(()=>[e(ee,{modelValue:d.keyword,"onUpdate:modelValue":l[0]||(l[0]=a=>d.keyword=a),placeholder:"请输入课程名称",clearable:"",onKeyup:me(I,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"学期"},{default:t(()=>[e(b,{modelValue:d.semester,"onUpdate:modelValue":l[1]||(l[1]=a=>d.semester=a),placeholder:"请选择学期",clearable:""},{default:t(()=>[e(n,{label:"2024春季",value:"2024春季"}),e(n,{label:"2023秋季",value:"2023秋季"}),e(n,{label:"2023春季",value:"2023春季"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"任课教师"},{default:t(()=>[e(b,{modelValue:d.teacherId,"onUpdate:modelValue":l[2]||(l[2]=a=>d.teacherId=a),placeholder:"请选择教师",clearable:""},{default:t(()=>[e(n,{label:"王老师",value:4}),e(n,{label:"刘老师",value:5}),e(n,{label:"陈老师",value:6})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"状态"},{default:t(()=>[e(b,{modelValue:d.status,"onUpdate:modelValue":l[3]||(l[3]=a=>d.status=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(n,{label:"开放选课",value:1}),e(n,{label:"选课结束",value:2}),e(n,{label:"取消开课",value:0})]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(_,{type:"primary",onClick:I},{default:t(()=>[e(w,null,{default:t(()=>[e(le)]),_:1}),l[14]||(l[14]=c(" 搜索 ",-1))]),_:1}),e(_,{onClick:P},{default:t(()=>[e(w,null,{default:t(()=>[e(te)]),_:1}),l[15]||(l[15]=c(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),_e((C(),q(ae,{data:B.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(i,{prop:"courseCode",label:"课程编号",width:"120"}),e(i,{prop:"courseName",label:"课程名称",width:"150"}),e(i,{prop:"credits",label:"学分",width:"80"}),e(i,{prop:"courseTypeText",label:"课程类型",width:"100"},{default:t(({row:a})=>[e(E,{type:a.courseType===1?"primary":"success"},{default:t(()=>[c(V(a.courseTypeText),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"semester",label:"学期",width:"120"}),e(i,{prop:"teacherName",label:"任课教师",width:"100"}),e(i,{prop:"maxStudents",label:"最大人数",width:"100"}),e(i,{prop:"currentStudents",label:"已选人数",width:"100"}),e(i,{prop:"statusText",label:"状态",width:"100"},{default:t(({row:a})=>[e(E,{type:Z(a.status)},{default:t(()=>[c(V(a.statusText),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"createTime",label:"创建时间",width:"160"}),e(i,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[e(_,{type:"primary",size:"small",onClick:R=>K(a)},{default:t(()=>[...l[16]||(l[16]=[c(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(_,{type:a.status===1?"warning":"success",size:"small",onClick:R=>H(a)},{default:t(()=>[c(V(a.status===1?"结束选课":"开放选课"),1)]),_:2},1032,["type","onClick"]),e(_,{type:"danger",size:"small",onClick:R=>G(a)},{default:t(()=>[...l[17]||(l[17]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,S.value]]),U("div",ke,[e(se,{"current-page":u.current,"onUpdate:currentPage":l[4]||(l[4]=a=>u.current=a),"page-size":u.size,"onUpdate:pageSize":l[5]||(l[5]=a=>u.size=a),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:Y},null,8,["current-page","page-size","total"])])]),_:1}),e(ue,{modelValue:v.value,"onUpdate:modelValue":l[11]||(l[11]=a=>v.value=a),title:M.value,width:"600px",onClose:W},{footer:t(()=>[e(_,{onClick:l[10]||(l[10]=a=>v.value=!1)},{default:t(()=>[...l[18]||(l[18]=[c("取消",-1)])]),_:1}),e(_,{type:"primary",onClick:Q,loading:x.value},{default:t(()=>[c(V(h.value?"更新":"发布"),1)]),_:1},8,["loading"])]),default:t(()=>[e($,{ref_key:"formRef",ref:z,model:r,rules:F,"label-width":"100px"},{default:t(()=>[e(p,{label:"课程",prop:"courseId"},{default:t(()=>[e(b,{modelValue:r.courseId,"onUpdate:modelValue":l[6]||(l[6]=a=>r.courseId=a),placeholder:"请选择课程",onChange:J},{default:t(()=>[(C(!0),j(fe,null,ge(k.value,a=>(C(),q(n,{key:a.id,label:a.courseName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(ne,{gutter:20},{default:t(()=>[e(N,{span:12},{default:t(()=>[e(p,{label:"学期",prop:"semester"},{default:t(()=>[e(b,{modelValue:r.semester,"onUpdate:modelValue":l[7]||(l[7]=a=>r.semester=a),placeholder:"请选择学期"},{default:t(()=>[e(n,{label:"2024春季",value:"2024春季"}),e(n,{label:"2023秋季",value:"2023秋季"}),e(n,{label:"2023春季",value:"2023春季"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(N,{span:12},{default:t(()=>[e(p,{label:"任课教师",prop:"teacherId"},{default:t(()=>[e(b,{modelValue:r.teacherId,"onUpdate:modelValue":l[8]||(l[8]=a=>r.teacherId=a),placeholder:"请选择教师"},{default:t(()=>[e(n,{label:"王老师",value:4}),e(n,{label:"刘老师",value:5}),e(n,{label:"陈老师",value:6})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{label:"最大选课人数",prop:"maxStudents"},{default:t(()=>[e(re,{modelValue:r.maxStudents,"onUpdate:modelValue":l[9]||(l[9]=a=>r.maxStudents=a),min:1,max:200,placeholder:"请输入最大选课人数",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},$e=Ve(Ie,[["__scopeId","data-v-deaed938"]]);export{$e as default};
