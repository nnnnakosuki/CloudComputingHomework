import{s as V,r as s,k as A,c as u,v as I,o as R,d as P,f as l,w as o,E as v,e as N,h as m,x as G,n as H,p as J}from"./index-9b5da449.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";function O(d){return V({url:"/roles",method:"get",params:d})}function Q(d){return V({url:"/roles",method:"post",data:d})}function W(d,f){return V({url:`/roles/${d}`,method:"put",data:f})}function X(d){return V({url:`/roles/${d}`,method:"delete"})}const Y={class:"roles-container"},Z={class:"card-header"},h={__name:"Roles",setup(d){const f=s(!1),k=s(!1),c=s(!1),y=s(!1),w=s(),x=s([]),_=s({keyword:""}),n=s({current:1,size:10,total:0}),a=s({roleCode:"",roleName:"",description:""}),B={roleCode:[{required:!0,message:"请输入角色代码",trigger:"blur"}],roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},i=async()=>{f.value=!0;try{const r=await O({current:n.value.current,size:n.value.size,..._.value});x.value=r.data.records,n.value.total=r.data.total}catch{v.error("加载角色列表失败")}finally{f.value=!1}},U=()=>{_.value={keyword:""},n.value.current=1,i()},$=()=>{y.value=!1,a.value={roleCode:"",roleName:"",description:""},c.value=!0},E=r=>{y.value=!0,a.value={...r},c.value=!0},F=async()=>{w.value&&await w.value.validate(async r=>{if(r){k.value=!0;try{y.value?(await W(a.value.id,a.value),v.success("更新角色成功")):(await Q(a.value),v.success("添加角色成功")),c.value=!1,i()}catch(e){v.error(e.message||"保存角色失败")}finally{k.value=!1}}})},q=async r=>{try{await J.confirm("确定要删除该角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await X(r),v.success("删除角色成功"),i()}catch(e){e!=="cancel"&&v.error("删除角色失败")}};return A(()=>{i()}),(r,e)=>{const p=u("el-button"),C=u("el-input"),g=u("el-form-item"),z=u("el-form"),b=u("el-table-column"),D=u("el-table"),M=u("el-pagination"),S=u("el-card"),T=u("el-dialog"),L=I("loading");return R(),P("div",Y,[l(S,null,{header:o(()=>[N("div",Z,[e[9]||(e[9]=N("span",null,"角色管理",-1)),l(p,{type:"primary",onClick:$},{default:o(()=>[...e[8]||(e[8]=[m("添加角色",-1)])]),_:1})])]),default:o(()=>[l(z,{model:_.value,inline:"",class:"search-form"},{default:o(()=>[l(g,{label:"关键词"},{default:o(()=>[l(C,{modelValue:_.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value.keyword=t),placeholder:"角色名称、代码或描述",clearable:""},null,8,["modelValue"])]),_:1}),l(g,null,{default:o(()=>[l(p,{type:"primary",onClick:i},{default:o(()=>[...e[10]||(e[10]=[m("搜索",-1)])]),_:1}),l(p,{onClick:U},{default:o(()=>[...e[11]||(e[11]=[m("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),G((R(),H(D,{data:x.value},{default:o(()=>[l(b,{prop:"roleCode",label:"角色代码"}),l(b,{prop:"roleName",label:"角色名称"}),l(b,{prop:"description",label:"描述"}),l(b,{label:"操作"},{default:o(({row:t})=>[l(p,{type:"primary",size:"small",onClick:j=>E(t)},{default:o(()=>[...e[12]||(e[12]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(p,{type:"danger",size:"small",onClick:j=>q(t.id)},{default:o(()=>[...e[13]||(e[13]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,f.value]]),l(M,{"current-page":n.value.current,"onUpdate:currentPage":e[1]||(e[1]=t=>n.value.current=t),"page-size":n.value.size,"onUpdate:pageSize":e[2]||(e[2]=t=>n.value.size=t),total:n.value.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i,onCurrentChange:i,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),l(T,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value=t),title:y.value?"编辑角色":"添加角色",width:"500px"},{footer:o(()=>[l(p,{onClick:e[6]||(e[6]=t=>c.value=!1)},{default:o(()=>[...e[14]||(e[14]=[m("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:F,loading:k.value},{default:o(()=>[...e[15]||(e[15]=[m("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(z,{model:a.value,rules:B,ref_key:"roleFormRef",ref:w,"label-width":"100px"},{default:o(()=>[l(g,{label:"角色代码",prop:"roleCode"},{default:o(()=>[l(C,{modelValue:a.value.roleCode,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.roleCode=t)},null,8,["modelValue"])]),_:1}),l(g,{label:"角色名称",prop:"roleName"},{default:o(()=>[l(C,{modelValue:a.value.roleName,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.roleName=t)},null,8,["modelValue"])]),_:1}),l(g,{label:"描述",prop:"description"},{default:o(()=>[l(C,{modelValue:a.value.description,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.description=t),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},oe=K(h,[["__scopeId","data-v-98ede98c"]]);export{oe as default};
