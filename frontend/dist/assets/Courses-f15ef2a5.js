import{u as ae,a as se,r as _,b as N,z as le,k as oe,c as n,v as ne,o as T,d as re,f as e,w as a,E as y,e as k,h as c,g as ue,x as E,n as P,t as U}from"./index-9b5da449.js";import{a as ie}from"./courseSchedule-2f0830e1.js";import{a as de}from"./courseSelection-a3ee75e2.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";const pe={class:"teacher-courses"},me={class:"card-header"},_e={class:"pagination"},fe={__name:"Courses",setup(ge){const L=ae(),K=se(),b=_(!1),C=_(!1),I=_([]),z=_([]),m=_(null),h=_(!1),u=N({current:1,size:10,total:0}),r=N({current:1,size:10,total:0}),p=N({semester:"2024春季",courseName:""}),f=async()=>{b.value=!0;try{const l=K.userInfo.id,t=await ie({current:u.current,size:u.size,semester:p.semester,teacherId:l});I.value=t.data.records||[],u.total=t.data.total||0}catch{y.error("获取课程列表失败")}finally{b.value=!1}},v=()=>{u.current=1,f()},M=()=>{Object.assign(p,{semester:"2024春季",courseName:""}),v()},F=async l=>{m.value=l,h.value=!0,await w(l.id)},w=async l=>{var t,g;C.value=!0;try{const d=await de({current:r.current,size:r.size,courseScheduleId:l,status:2});z.value=(d.data.records||[]).map(i=>({...i,genderText:i.gender===1?"男":"女",statusText:i.status===1?"待确认":i.status===2?"已确认":"已退课"})),r.total=d.data.total||0}catch(d){y.error("加载学生名单失败: "+(((g=(t=d.response)==null?void 0:t.data)==null?void 0:g.message)||d.message))}finally{C.value=!1}},G=l=>{r.size=l,r.current=1,m.value&&w(m.value.id)},O=l=>{r.current=l,m.value&&w(m.value.id)};le(h,l=>{l||(r.current=1,r.size=10,z.value=[])});const q=l=>{y.info(`录入课程"${l.courseName}"的成绩`),L.push("/teacher/grades")},A=l=>{y.info(`查看课程"${l.courseName}"的课表`),L.push("/teacher/schedule")},H=l=>{u.size=l,f()},J=l=>{u.current=l,f()},Q=l=>{switch(l){case 1:return"success";case 2:return"warning";case 0:return"danger";default:return"info"}};return oe(()=>{f()}),(l,t)=>{var D;const g=n("Refresh"),d=n("el-icon"),i=n("el-button"),x=n("el-option"),W=n("el-select"),S=n("el-form-item"),X=n("el-input"),Y=n("Search"),Z=n("el-form"),o=n("el-table-column"),V=n("el-tag"),$=n("el-table"),j=n("el-pagination"),ee=n("el-card"),te=n("el-dialog"),B=ne("loading");return T(),re("div",pe,[e(ee,null,{header:a(()=>[k("div",me,[t[8]||(t[8]=k("span",null,"我的课程",-1)),e(i,{onClick:f},{default:a(()=>[e(d,null,{default:a(()=>[e(g)]),_:1}),t[7]||(t[7]=c(" 刷新 ",-1))]),_:1})])]),default:a(()=>[e(Z,{model:p,inline:"",class:"search-form"},{default:a(()=>[e(S,{label:"学期"},{default:a(()=>[e(W,{modelValue:p.semester,"onUpdate:modelValue":t[0]||(t[0]=s=>p.semester=s),placeholder:"请选择学期",onChange:v,style:{width:"150px"}},{default:a(()=>[e(x,{label:"2024春季",value:"2024春季"}),e(x,{label:"2023秋季",value:"2023秋季"}),e(x,{label:"2023春季",value:"2023春季"})]),_:1},8,["modelValue"])]),_:1}),e(S,{label:"课程名称"},{default:a(()=>[e(X,{modelValue:p.courseName,"onUpdate:modelValue":t[1]||(t[1]=s=>p.courseName=s),placeholder:"请输入课程名称",clearable:"",onKeyup:ue(v,["enter"])},null,8,["modelValue"])]),_:1}),e(S,null,{default:a(()=>[e(i,{type:"primary",onClick:v},{default:a(()=>[e(d,null,{default:a(()=>[e(Y)]),_:1}),t[9]||(t[9]=c(" 搜索 ",-1))]),_:1}),e(i,{onClick:M},{default:a(()=>[e(d,null,{default:a(()=>[e(g)]),_:1}),t[10]||(t[10]=c(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),E((T(),P($,{data:I.value,stripe:"",style:{width:"100%"}},{default:a(()=>[e(o,{prop:"courseCode",label:"课程编号",width:"120"}),e(o,{prop:"courseName",label:"课程名称",width:"200"}),e(o,{prop:"credits",label:"学分",width:"80"}),e(o,{prop:"courseTypeText",label:"课程类型",width:"100"},{default:a(({row:s})=>[e(V,{type:s.courseType===1?"primary":"success"},{default:a(()=>[c(U(s.courseTypeText),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"semester",label:"学期",width:"120"}),e(o,{prop:"maxStudents",label:"容量",width:"80"}),e(o,{prop:"currentStudents",label:"已选",width:"80"}),e(o,{prop:"statusText",label:"状态",width:"100"},{default:a(({row:s})=>[e(V,{type:Q(s.status)},{default:a(()=>[c(U(s.statusText),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"createTime",label:"创建时间",width:"160"}),e(o,{label:"操作",width:"200",fixed:"right"},{default:a(({row:s})=>[e(i,{type:"primary",size:"small",onClick:R=>F(s)},{default:a(()=>[...t[11]||(t[11]=[c(" 学生名单 ",-1)])]),_:1},8,["onClick"]),e(i,{type:"success",size:"small",onClick:R=>q(s)},{default:a(()=>[...t[12]||(t[12]=[c(" 成绩录入 ",-1)])]),_:1},8,["onClick"]),e(i,{type:"info",size:"small",onClick:R=>A(s)},{default:a(()=>[...t[13]||(t[13]=[c(" 查看课表 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,b.value]]),k("div",_e,[e(j,{"current-page":u.current,"onUpdate:currentPage":t[2]||(t[2]=s=>u.current=s),"page-size":u.size,"onUpdate:pageSize":t[3]||(t[3]=s=>u.size=s),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:J},null,8,["current-page","page-size","total"])])]),_:1}),e(te,{modelValue:h.value,"onUpdate:modelValue":t[6]||(t[6]=s=>h.value=s),title:`${(D=m.value)==null?void 0:D.courseName} - 学生名单`,width:"900px"},{footer:a(()=>[e(j,{"current-page":r.current,"onUpdate:currentPage":t[4]||(t[4]=s=>r.current=s),"page-size":r.size,"onUpdate:pageSize":t[5]||(t[5]=s=>r.size=s),total:r.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:G,onCurrentChange:O,style:{"justify-content":"flex-start"}},null,8,["current-page","page-size","total"])]),default:a(()=>[E((T(),P($,{data:z.value,stripe:"","max-height":"400"},{default:a(()=>[e(o,{type:"index",label:"序号",width:"60"}),e(o,{prop:"studentNo",label:"学号",width:"120"}),e(o,{prop:"studentName",label:"姓名",width:"100"}),e(o,{prop:"className",label:"班级",width:"120"}),e(o,{prop:"major",label:"专业",width:"180"}),e(o,{prop:"genderText",label:"性别",width:"80"}),e(o,{prop:"phone",label:"联系电话",width:"120"}),e(o,{label:"状态",width:"100"},{default:a(({row:s})=>[e(V,{type:s.status===1?"success":"warning"},{default:a(()=>[c(U(s.statusText),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[B,C.value]])]),_:1},8,["modelValue","title"])])}}},Ce=ce(fe,[["__scopeId","data-v-12ef7df0"]]);export{Ce as default};
