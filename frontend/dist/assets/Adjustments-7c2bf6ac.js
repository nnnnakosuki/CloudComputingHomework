import{s as V,r as g,b as A,k as oe,c as o,v as se,o as c,d as R,f as t,w as a,E as m,e as $,h as r,g as re,x as ue,n as v,t as de,m as S,F as ie,q as pe,p as q}from"./index-9b5da449.js";import{c as ce}from"./classSchedule-bac13fb3.js";import{_ as me}from"./_plugin-vue_export-helper-c27b6911.js";const fe=p=>V({url:"/schedule-adjustments",method:"get",params:p}),_e=p=>V({url:"/schedule-adjustments/apply",method:"post",data:p}),ye=(p,b,h)=>V({url:`/schedule-adjustments/${p}/approve`,method:"post",params:{status:b,remark:h}}),ge=p=>V({url:`/schedule-adjustments/${p}/execute`,method:"post"});const ve={class:"schedule-adjustment-management"},be={class:"card-header"},he={class:"pagination"},we={__name:"Adjustments",setup(p){const b=g(!1),h=g(!1),w=g(!1),j=g(),T=g([]),B=g([]),s=A({current:1,size:10,total:0}),f=A({keyword:"",status:null}),u=A({classScheduleId:null,reason:"",newInfo:""}),E={classScheduleId:[{required:!0,message:"请选择排课记录",trigger:"change"}],reason:[{required:!0,message:"请输入调课原因",trigger:"blur"}],newInfo:[{required:!0,message:"请输入新排课信息",trigger:"blur"}]},_=async()=>{b.value=!0;try{const n=await fe({current:s.current,size:s.size,...f});T.value=n.data.records,s.total=n.data.total}catch{m.error("获取调课记录失败")}finally{b.value=!1}},M=async()=>{try{const n=await ce({});B.value=n.data.records||[]}catch{m.error("获取排课记录失败")}},z=()=>{s.current=1,_()},P=()=>{Object.assign(f,{keyword:"",status:null}),z()},K=()=>{L(),w.value=!0},F=async(n,e)=>{const k=e===2?"通过":"驳回";try{await q.confirm(`确定要${k}该调课申请吗？`,"确认审批",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ye(n.id,e,""),m.success(`${k}成功`),_()}catch(x){x!=="cancel"&&m.error(`${k}失败`)}},O=async n=>{try{await q.confirm("确定要执行该调课吗？","确认执行",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ge(n.id),m.success("执行成功"),_()}catch(e){e!=="cancel"&&m.error("执行失败")}},G=async()=>{j.value&&await j.value.validate(async n=>{if(n){h.value=!0;try{await _e(u),m.success("申请调课成功"),w.value=!1,_()}catch(e){m.error(e.message||"申请调课失败")}finally{h.value=!1}}})},H=()=>{L()},L=()=>{Object.assign(u,{classScheduleId:null,reason:"",newInfo:""})},J=n=>{s.size=n,_()},Q=n=>{s.current=n,_()},W=n=>{switch(n){case 1:return"warning";case 2:return"success";case 3:return"danger";default:return"info"}};return oe(()=>{_(),M()}),(n,e)=>{const k=o("Plus"),x=o("el-icon"),d=o("el-button"),I=o("el-input"),y=o("el-form-item"),C=o("el-option"),N=o("el-select"),X=o("Search"),Y=o("Refresh"),U=o("el-form"),i=o("el-table-column"),Z=o("el-tag"),ee=o("el-table"),te=o("el-pagination"),le=o("el-card"),ae=o("el-dialog"),ne=se("loading");return c(),R("div",ve,[t(le,null,{header:a(()=>[$("div",be,[e[10]||(e[10]=$("span",null,"调课管理",-1)),t(d,{type:"primary",onClick:K},{default:a(()=>[t(x,null,{default:a(()=>[t(k)]),_:1}),e[9]||(e[9]=r(" 申请调课 ",-1))]),_:1})])]),default:a(()=>[t(U,{model:f,inline:"",class:"search-form"},{default:a(()=>[t(y,{label:"关键词"},{default:a(()=>[t(I,{modelValue:f.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>f.keyword=l),placeholder:"请输入调课原因",clearable:"",onKeyup:re(z,["enter"])},null,8,["modelValue"])]),_:1}),t(y,{label:"状态"},{default:a(()=>[t(N,{modelValue:f.status,"onUpdate:modelValue":e[1]||(e[1]=l=>f.status=l),placeholder:"请选择状态",clearable:"",style:{width:"150px"}},{default:a(()=>[t(C,{label:"待审批",value:1}),t(C,{label:"已通过",value:2}),t(C,{label:"已驳回",value:3})]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:a(()=>[t(d,{type:"primary",onClick:z},{default:a(()=>[t(x,null,{default:a(()=>[t(X)]),_:1}),e[11]||(e[11]=r(" 搜索 ",-1))]),_:1}),t(d,{onClick:P},{default:a(()=>[t(x,null,{default:a(()=>[t(Y)]),_:1}),e[12]||(e[12]=r(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),ue((c(),v(ee,{data:T.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(i,{prop:"courseName",label:"课程名称",width:"150"}),t(i,{prop:"teacherName",label:"任课教师",width:"100"}),t(i,{prop:"oldInfo",label:"原排课信息",width:"200"}),t(i,{prop:"newInfo",label:"新排课信息",width:"200"}),t(i,{prop:"reason",label:"调课原因",width:"150"}),t(i,{prop:"operatorName",label:"申请人",width:"100"}),t(i,{prop:"statusText",label:"状态",width:"100"},{default:a(({row:l})=>[t(Z,{type:W(l.status)},{default:a(()=>[r(de(l.statusText),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"createTime",label:"申请时间",width:"160"}),t(i,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[l.status===1?(c(),v(d,{key:0,type:"success",size:"small",onClick:D=>F(l,2)},{default:a(()=>[...e[13]||(e[13]=[r(" 通过 ",-1)])]),_:1},8,["onClick"])):S("",!0),l.status===1?(c(),v(d,{key:1,type:"danger",size:"small",onClick:D=>F(l,3)},{default:a(()=>[...e[14]||(e[14]=[r(" 驳回 ",-1)])]),_:1},8,["onClick"])):S("",!0),l.status===2?(c(),v(d,{key:2,type:"primary",size:"small",onClick:D=>O(l)},{default:a(()=>[...e[15]||(e[15]=[r(" 执行 ",-1)])]),_:1},8,["onClick"])):S("",!0),l.status!==1?(c(),v(d,{key:3,type:"info",size:"small",disabled:""},{default:a(()=>[...e[16]||(e[16]=[r(" 已处理 ",-1)])]),_:1})):S("",!0)]),_:1})]),_:1},8,["data"])),[[ne,b.value]]),$("div",he,[t(te,{"current-page":s.current,"onUpdate:currentPage":e[2]||(e[2]=l=>s.current=l),"page-size":s.size,"onUpdate:pageSize":e[3]||(e[3]=l=>s.size=l),total:s.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),_:1}),t(ae,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=l=>w.value=l),title:"申请调课",width:"600px",onClose:H},{footer:a(()=>[t(d,{onClick:e[7]||(e[7]=l=>w.value=!1)},{default:a(()=>[...e[17]||(e[17]=[r("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:G,loading:h.value},{default:a(()=>[...e[18]||(e[18]=[r(" 申请调课 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(U,{ref_key:"applyFormRef",ref:j,model:u,rules:E,"label-width":"100px"},{default:a(()=>[t(y,{label:"排课记录",prop:"classScheduleId"},{default:a(()=>[t(N,{modelValue:u.classScheduleId,"onUpdate:modelValue":e[4]||(e[4]=l=>u.classScheduleId=l),placeholder:"请选择排课记录"},{default:a(()=>[(c(!0),R(ie,null,pe(B.value,l=>(c(),v(C,{key:l.id,label:`${l.courseName} - ${l.weekDayText} ${l.startTime}-${l.endTime}`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"调课原因",prop:"reason"},{default:a(()=>[t(I,{modelValue:u.reason,"onUpdate:modelValue":e[5]||(e[5]=l=>u.reason=l),type:"textarea",rows:3,placeholder:"请输入调课原因"},null,8,["modelValue"])]),_:1}),t(y,{label:"新排课信息",prop:"newInfo"},{default:a(()=>[t(I,{modelValue:u.newInfo,"onUpdate:modelValue":e[6]||(e[6]=l=>u.newInfo=l),type:"textarea",rows:3,placeholder:"请输入新的排课信息（如：星期三 14:00-15:40 A103）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Se=me(we,[["__scopeId","data-v-37000ceb"]]);export{Se as default};
