import{s as k,r as p,k as K,c as u,v as O,o as z,d as Q,f as l,w as a,E as g,e as $,h as m,x as W,n as q,t as E,m as X,p as Y}from"./index-9b5da449.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";function h(v){return k({url:"/users",method:"get",params:v})}function ee(v){return k({url:"/users",method:"post",data:v})}function le(v,y){return k({url:`/users/${v}`,method:"put",data:y})}function ae(v){return k({url:`/users/${v}`,method:"delete"})}const te={class:"users-container"},oe={class:"card-header"},se={__name:"Users",setup(v){const y=p(!1),C=p(!1),_=p(!1),b=p(!1),x=p(),N=p([]),n=p({keyword:"",roleId:null,status:null}),d=p({current:1,size:10,total:0}),o=p({username:"",realName:"",password:"",roleId:null,status:1}),M={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}]},f=async()=>{y.value=!0;try{const s=await h({current:d.value.current,size:d.value.size,...n.value});N.value=s.data.records,d.value.total=s.data.total}catch{g.error("加载用户列表失败")}finally{y.value=!1}},T=()=>{n.value={keyword:"",roleId:null,status:null},d.value.current=1,f()},D=()=>{b.value=!1,o.value={username:"",realName:"",password:"",roleId:null,status:1},_.value=!0},F=s=>{b.value=!0,o.value={...s},_.value=!0},S=async()=>{x.value&&await x.value.validate(async s=>{if(s){C.value=!0;try{b.value?(await le(o.value.id,o.value),g.success("更新用户成功")):(await ee(o.value),g.success("添加用户成功")),_.value=!1,f()}catch(e){g.error(e.message||"保存用户失败")}finally{C.value=!1}}})},R=async s=>{try{await Y.confirm("确定要删除该用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ae(s),g.success("删除用户成功"),f()}catch(e){e!=="cancel"&&g.error("删除用户失败")}},L=s=>({admin:"danger",teacher:"warning",student:"success"})[s]||"info";return K(()=>{f()}),(s,e)=>{const c=u("el-button"),w=u("el-input"),i=u("el-form-item"),r=u("el-option"),U=u("el-select"),I=u("el-form"),V=u("el-table-column"),B=u("el-tag"),j=u("el-table"),A=u("el-pagination"),P=u("el-card"),G=u("el-dialog"),H=O("loading");return z(),Q("div",te,[l(P,null,{header:a(()=>[$("div",oe,[e[13]||(e[13]=$("span",null,"用户管理",-1)),l(c,{type:"primary",onClick:D},{default:a(()=>[...e[12]||(e[12]=[m("添加用户",-1)])]),_:1})])]),default:a(()=>[l(I,{model:n.value,inline:"",class:"search-form"},{default:a(()=>[l(i,{label:"关键词"},{default:a(()=>[l(w,{modelValue:n.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.keyword=t),placeholder:"用户名或真实姓名",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"角色"},{default:a(()=>[l(U,{modelValue:n.value.roleId,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.roleId=t),placeholder:"选择角色",clearable:"",style:{width:"120px"}},{default:a(()=>[l(r,{label:"管理员",value:1}),l(r,{label:"教师",value:3}),l(r,{label:"学生",value:4})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"状态"},{default:a(()=>[l(U,{modelValue:n.value.status,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.status=t),placeholder:"选择状态",clearable:"",style:{width:"120px"}},{default:a(()=>[l(r,{label:"正常",value:1}),l(r,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:a(()=>[l(c,{type:"primary",onClick:f},{default:a(()=>[...e[14]||(e[14]=[m("搜索",-1)])]),_:1}),l(c,{onClick:T},{default:a(()=>[...e[15]||(e[15]=[m("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),W((z(),q(j,{data:N.value},{default:a(()=>[l(V,{prop:"username",label:"用户名"}),l(V,{prop:"realName",label:"真实姓名"}),l(V,{prop:"roleCode",label:"角色"},{default:a(({row:t})=>[l(B,{type:L(t.roleCode)},{default:a(()=>[m(E(t.roleName),1)]),_:2},1032,["type"])]),_:1}),l(V,{prop:"status",label:"状态"},{default:a(({row:t})=>[l(B,{type:t.status===1?"success":"danger"},{default:a(()=>[m(E(t.statusText),1)]),_:2},1032,["type"])]),_:1}),l(V,{label:"操作"},{default:a(({row:t})=>[l(c,{type:"primary",size:"small",onClick:J=>F(t)},{default:a(()=>[...e[16]||(e[16]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(c,{type:"danger",size:"small",onClick:J=>R(t.id)},{default:a(()=>[...e[17]||(e[17]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,y.value]]),l(A,{"current-page":d.value.current,"onUpdate:currentPage":e[3]||(e[3]=t=>d.value.current=t),"page-size":d.value.size,"onUpdate:pageSize":e[4]||(e[4]=t=>d.value.size=t),total:d.value.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),l(G,{modelValue:_.value,"onUpdate:modelValue":e[11]||(e[11]=t=>_.value=t),title:b.value?"编辑用户":"添加用户",width:"500px"},{footer:a(()=>[l(c,{onClick:e[10]||(e[10]=t=>_.value=!1)},{default:a(()=>[...e[18]||(e[18]=[m("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:S,loading:C.value},{default:a(()=>[...e[19]||(e[19]=[m("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(I,{model:o.value,rules:M,ref_key:"userFormRef",ref:x,"label-width":"100px"},{default:a(()=>[l(i,{label:"用户名",prop:"username"},{default:a(()=>[l(w,{modelValue:o.value.username,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.username=t)},null,8,["modelValue"])]),_:1}),l(i,{label:"真实姓名",prop:"realName"},{default:a(()=>[l(w,{modelValue:o.value.realName,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.realName=t)},null,8,["modelValue"])]),_:1}),b.value?X("",!0):(z(),q(i,{key:0,label:"密码",prop:"password"},{default:a(()=>[l(w,{modelValue:o.value.password,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.password=t),type:"password"},null,8,["modelValue"])]),_:1})),l(i,{label:"角色",prop:"roleId"},{default:a(()=>[l(U,{modelValue:o.value.roleId,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.roleId=t),style:{width:"100%"}},{default:a(()=>[l(r,{label:"管理员",value:1}),l(r,{label:"教师",value:3}),l(r,{label:"学生",value:4})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"状态",prop:"status"},{default:a(()=>[l(U,{modelValue:o.value.status,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.status=t),style:{width:"100%"}},{default:a(()=>[l(r,{label:"正常",value:1}),l(r,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ne=Z(se,[["__scopeId","data-v-f1aa5225"]]);export{ne as default};
