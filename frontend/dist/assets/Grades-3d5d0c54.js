import{r as _,b as z,j as Y,k as Z,c as u,v as ee,o as b,d as te,f as e,w as l,E as x,e as y,g as D,l as F,h as p,x as ae,n as k,t as I,y as le,m as U,B as oe,C as ue}from"./index-9b5da449.js";import{a as se,c as ne}from"./grade-b0111342.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const re={class:"grade-audit"},ie={class:"pagination"},me={__name:"Grades",setup(pe){const N=_(!1),S=_(!1),g=_(!1),h=_([]),r=_({}),s=z({current:1,size:10,total:0}),i=z({studentName:"",courseName:"",auditStatus:null}),d=z({gradeId:null,auditStatus:null,remark:""}),L={remark:[{required:!0,message:"请输入审核意见",trigger:"blur"}]},R=Y(()=>d.auditStatus===2?"审核通过":"审核驳回"),C=_(),v=async()=>{N.value=!0;try{const o=await se({current:s.current,size:s.size,...i});h.value=o.data.records||[],s.total=o.data.total||0}catch{x.error("获取成绩列表失败")}finally{N.value=!1}},V=()=>{s.current=1,v()},j=()=>{Object.assign(i,{studentName:"",courseName:"",auditStatus:null}),V()},G=(o,t)=>{r.value=o,d.gradeId=o.id,d.auditStatus=t,d.remark="",g.value=!0},A=async()=>{C.value&&await C.value.validate(async o=>{if(o){S.value=!0;try{await ne(d.gradeId,d.auditStatus,d.remark),x.success("审核成功"),g.value=!1,v()}catch(t){x.error(t.message||"审核失败")}finally{S.value=!1}}})},E=o=>{s.size=o,v()},K=o=>{s.current=o,v()},$=o=>o>=90?"score-excellent":o>=80?"score-good":o>=70?"score-medium":o>=60?"score-pass":"score-fail",M=o=>{switch(o){case 1:return"warning";case 2:return"success";case 3:return"danger";default:return""}};return Z(()=>{v()}),(o,t)=>{const c=u("el-input"),m=u("el-form-item"),w=u("el-option"),q=u("el-select"),T=u("el-icon"),f=u("el-button"),B=u("el-form"),n=u("el-table-column"),O=u("el-tag"),P=u("el-table"),H=u("el-pagination"),J=u("el-card"),Q=u("el-dialog"),W=ee("loading");return b(),te("div",re,[e(J,null,{header:l(()=>[...t[12]||(t[12]=[y("div",{class:"card-header"},[y("span",null,"成绩审核")],-1)])]),default:l(()=>[e(B,{model:i,inline:"",class:"search-form"},{default:l(()=>[e(m,{label:"学生姓名"},{default:l(()=>[e(c,{modelValue:i.studentName,"onUpdate:modelValue":t[0]||(t[0]=a=>i.studentName=a),placeholder:"请输入学生姓名",clearable:"",onKeyup:D(V,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"课程名称"},{default:l(()=>[e(c,{modelValue:i.courseName,"onUpdate:modelValue":t[1]||(t[1]=a=>i.courseName=a),placeholder:"请输入课程名称",clearable:"",onKeyup:D(V,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"审核状态"},{default:l(()=>[e(q,{modelValue:i.auditStatus,"onUpdate:modelValue":t[2]||(t[2]=a=>i.auditStatus=a),placeholder:"请选择审核状态",clearable:""},{default:l(()=>[e(w,{label:"待审核",value:1}),e(w,{label:"已通过",value:2}),e(w,{label:"已驳回",value:3})]),_:1},8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(f,{type:"primary",onClick:V},{default:l(()=>[e(T,null,{default:l(()=>[e(F(oe))]),_:1}),t[13]||(t[13]=p(" 搜索 ",-1))]),_:1}),e(f,{onClick:j},{default:l(()=>[e(T,null,{default:l(()=>[e(F(ue))]),_:1}),t[14]||(t[14]=p(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),ae((b(),k(P,{data:h.value,stripe:"",style:{width:"100%"}},{default:l(()=>[e(n,{prop:"studentNo",label:"学号",width:"120"}),e(n,{prop:"studentName",label:"学生姓名",width:"100"}),e(n,{prop:"courseCode",label:"课程编号",width:"120"}),e(n,{prop:"courseName",label:"课程名称",width:"150"}),e(n,{prop:"score",label:"成绩",width:"80"},{default:l(({row:a})=>[y("span",{class:le($(a.score))},I(a.score),3)]),_:1}),e(n,{prop:"teacherName",label:"任课教师",width:"100"}),e(n,{prop:"submitTime",label:"提交时间",width:"160"}),e(n,{prop:"auditStatusText",label:"审核状态",width:"100"},{default:l(({row:a})=>[e(O,{type:M(a.auditStatus)},{default:l(()=>[p(I(a.auditStatusText),1)]),_:2},1032,["type"])]),_:1}),e(n,{prop:"auditorName",label:"审核员",width:"100"}),e(n,{prop:"auditTime",label:"审核时间",width:"160"}),e(n,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[a.auditStatus===1?(b(),k(f,{key:0,type:"success",size:"small",onClick:X=>G(a,2)},{default:l(()=>[...t[15]||(t[15]=[p(" 通过 ",-1)])]),_:1},8,["onClick"])):U("",!0),a.auditStatus===1?(b(),k(f,{key:1,type:"danger",size:"small",onClick:X=>G(a,3)},{default:l(()=>[...t[16]||(t[16]=[p(" 驳回 ",-1)])]),_:1},8,["onClick"])):U("",!0),a.auditStatus!==1?(b(),k(f,{key:2,type:"info",size:"small",disabled:""},{default:l(()=>[...t[17]||(t[17]=[p(" 已审核 ",-1)])]),_:1})):U("",!0)]),_:1})]),_:1},8,["data"])),[[W,N.value]]),y("div",ie,[e(H,{"current-page":s.current,"onUpdate:currentPage":t[3]||(t[3]=a=>s.current=a),"page-size":s.size,"onUpdate:pageSize":t[4]||(t[4]=a=>s.size=a),total:s.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:E,onCurrentChange:K},null,8,["current-page","page-size","total"])])]),_:1}),e(Q,{modelValue:g.value,"onUpdate:modelValue":t[11]||(t[11]=a=>g.value=a),title:R.value,width:"500px"},{footer:l(()=>[e(f,{onClick:t[10]||(t[10]=a=>g.value=!1)},{default:l(()=>[...t[18]||(t[18]=[p("取消",-1)])]),_:1}),e(f,{type:"primary",onClick:A,loading:S.value},{default:l(()=>[...t[19]||(t[19]=[p(" 确认审核 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[e(B,{ref_key:"auditFormRef",ref:C,model:d,rules:L,"label-width":"100px"},{default:l(()=>[e(m,{label:"学生姓名"},{default:l(()=>[e(c,{modelValue:r.value.studentName,"onUpdate:modelValue":t[5]||(t[5]=a=>r.value.studentName=a),disabled:""},null,8,["modelValue"])]),_:1}),e(m,{label:"课程名称"},{default:l(()=>[e(c,{modelValue:r.value.courseName,"onUpdate:modelValue":t[6]||(t[6]=a=>r.value.courseName=a),disabled:""},null,8,["modelValue"])]),_:1}),e(m,{label:"成绩"},{default:l(()=>[e(c,{modelValue:r.value.score,"onUpdate:modelValue":t[7]||(t[7]=a=>r.value.score=a),disabled:""},null,8,["modelValue"])]),_:1}),e(m,{label:"任课教师"},{default:l(()=>[e(c,{modelValue:r.value.teacherName,"onUpdate:modelValue":t[8]||(t[8]=a=>r.value.teacherName=a),disabled:""},null,8,["modelValue"])]),_:1}),e(m,{label:"审核意见",prop:"remark"},{default:l(()=>[e(c,{modelValue:d.remark,"onUpdate:modelValue":t[9]||(t[9]=a=>d.remark=a),type:"textarea",rows:3,placeholder:"请输入审核意见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ge=de(me,[["__scopeId","data-v-971eed95"]]);export{ge as default};
