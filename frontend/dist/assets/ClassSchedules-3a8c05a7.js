import{r as f,b as R,j as be,k as ge,c as d,v as we,o as y,d as E,f as e,w as a,E as b,e as U,h as m,g as he,x as ye,n as N,t as Ve,F as G,q as J,p as ke}from"./index-9b5da449.js";import{c as Ce,d as Se,u as Te,e as Ue,f as xe}from"./classSchedule-bac13fb3.js";import{a as De}from"./courseSchedule-2f0830e1.js";import{_ as ze}from"./_plugin-vue_export-helper-c27b6911.js";const He={class:"class-schedule-management"},Be={class:"card-header"},Ie={class:"pagination"},$e={style:{"margin-top":"20px"}},Le={__name:"ClassSchedules",setup(Re){const z=f(!1),H=f(!1),B=f(!1),w=f(!1),V=f(!1),k=f(!1),q=f([]),I=f([]),C=f([]),p=R({current:1,size:10,total:0}),v=R({keyword:"",semester:"",weekDay:null}),n=R({id:null,courseScheduleId:null,weekDay:null,startTime:null,endTime:null,classroom:"",weeks:""}),Q={courseScheduleId:[{required:!0,message:"请选择开课计划",trigger:"change"}],weekDay:[{required:!0,message:"请选择星期",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],classroom:[{required:!0,message:"请输入教室",trigger:"blur"}]},W=be(()=>k.value?"编辑排课":"添加排课"),g=async()=>{z.value=!0;try{const s=await Ce({current:p.current,size:p.size,...v});q.value=s.data.records,p.total=s.data.total}catch{b.error("获取排课列表失败")}finally{z.value=!1}},X=async()=>{try{const s=await De({});I.value=s.data.records||[]}catch{b.error("获取开课计划列表失败")}},$=()=>{p.current=1,g()},Y=()=>{Object.assign(v,{keyword:"",semester:"",weekDay:null}),$()},Z=()=>{k.value=!1,F(),w.value=!0},ee=s=>{k.value=!0,Object.assign(n,s),w.value=!0},le=async s=>{try{await ke.confirm("确定要删除该排课记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Se(s.id),b.success("删除成功"),g()}catch(l){l!=="cancel"&&b.error("删除失败")}},ae=()=>{C.value=[j()],V.value=!0},te=()=>{C.value.push(j())},oe=s=>{C.value.splice(s,1)},j=()=>({courseScheduleId:null,weekDay:null,startTime:null,endTime:null,classroom:"",weeks:""}),se=s=>{},L=f(),ue=async()=>{L.value&&await L.value.validate(async s=>{if(s){H.value=!0;try{k.value?(await Te(n.id,n),b.success("更新成功")):(await Ue(n),b.success("添加成功")),w.value=!1,g()}catch(l){b.error(l.message||"操作失败")}finally{H.value=!1}}})},de=async()=>{B.value=!0;try{await xe(C.value),b.success("批量添加成功"),V.value=!1,g()}catch(s){b.error(s.message||"批量添加失败")}finally{B.value=!1}},ne=()=>{F()},F=()=>{Object.assign(n,{id:null,courseScheduleId:null,weekDay:null,startTime:null,endTime:null,classroom:"",weeks:""})},re=s=>{p.size=s,g()},ie=s=>{p.current=s,g()};return ge(()=>{g(),X()}),(s,l)=>{const A=d("Plus"),S=d("el-icon"),i=d("el-button"),me=d("Upload"),T=d("el-input"),c=d("el-form-item"),o=d("el-option"),h=d("el-select"),pe=d("Search"),ce=d("Refresh"),M=d("el-form"),u=d("el-table-column"),O=d("el-table"),fe=d("el-pagination"),ve=d("el-card"),x=d("el-col"),P=d("el-row"),D=d("el-time-picker"),K=d("el-dialog"),_e=we("loading");return y(),E("div",He,[e(ve,null,{header:a(()=>[U("div",Be,[l[17]||(l[17]=U("span",null,"排课管理",-1)),U("div",null,[e(i,{type:"primary",onClick:Z},{default:a(()=>[e(S,null,{default:a(()=>[e(A)]),_:1}),l[15]||(l[15]=m(" 添加排课 ",-1))]),_:1}),e(i,{type:"success",onClick:ae},{default:a(()=>[e(S,null,{default:a(()=>[e(me)]),_:1}),l[16]||(l[16]=m(" 批量排课 ",-1))]),_:1})])])]),default:a(()=>[e(M,{model:v,inline:"",class:"search-form"},{default:a(()=>[e(c,{label:"关键词"},{default:a(()=>[e(T,{modelValue:v.keyword,"onUpdate:modelValue":l[0]||(l[0]=t=>v.keyword=t),placeholder:"请输入课程名称",clearable:"",onKeyup:he($,["enter"])},null,8,["modelValue"])]),_:1}),e(c,{label:"学期"},{default:a(()=>[e(h,{modelValue:v.semester,"onUpdate:modelValue":l[1]||(l[1]=t=>v.semester=t),placeholder:"请选择学期",clearable:""},{default:a(()=>[e(o,{label:"2024春季",value:"2024春季"}),e(o,{label:"2023秋季",value:"2023秋季"}),e(o,{label:"2023春季",value:"2023春季"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"星期"},{default:a(()=>[e(h,{modelValue:v.weekDay,"onUpdate:modelValue":l[2]||(l[2]=t=>v.weekDay=t),placeholder:"请选择星期",clearable:""},{default:a(()=>[e(o,{label:"星期一",value:1}),e(o,{label:"星期二",value:2}),e(o,{label:"星期三",value:3}),e(o,{label:"星期四",value:4}),e(o,{label:"星期五",value:5}),e(o,{label:"星期六",value:6}),e(o,{label:"星期日",value:7})]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:a(()=>[e(i,{type:"primary",onClick:$},{default:a(()=>[e(S,null,{default:a(()=>[e(pe)]),_:1}),l[18]||(l[18]=m(" 搜索 ",-1))]),_:1}),e(i,{onClick:Y},{default:a(()=>[e(S,null,{default:a(()=>[e(ce)]),_:1}),l[19]||(l[19]=m(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),ye((y(),N(O,{data:q.value,stripe:"",style:{width:"100%"}},{default:a(()=>[e(u,{prop:"courseCode",label:"课程编号",width:"120"}),e(u,{prop:"courseName",label:"课程名称",width:"150"}),e(u,{prop:"teacherName",label:"任课教师",width:"100"}),e(u,{prop:"semester",label:"学期",width:"120"}),e(u,{prop:"weekDayText",label:"星期",width:"100"}),e(u,{prop:"startTime",label:"开始时间",width:"120"}),e(u,{prop:"endTime",label:"结束时间",width:"120"}),e(u,{prop:"classroom",label:"教室",width:"120"}),e(u,{prop:"weeks",label:"周次",width:"120"}),e(u,{prop:"maxStudents",label:"容量",width:"80"}),e(u,{prop:"currentStudents",label:"已选",width:"80"}),e(u,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[e(i,{type:"primary",size:"small",onClick:_=>ee(t)},{default:a(()=>[...l[20]||(l[20]=[m(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(i,{type:"danger",size:"small",onClick:_=>le(t)},{default:a(()=>[...l[21]||(l[21]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[_e,z.value]]),U("div",Ie,[e(fe,{"current-page":p.current,"onUpdate:currentPage":l[3]||(l[3]=t=>p.current=t),"page-size":p.size,"onUpdate:pageSize":l[4]||(l[4]=t=>p.size=t),total:p.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:ie},null,8,["current-page","page-size","total"])])]),_:1}),e(K,{modelValue:w.value,"onUpdate:modelValue":l[12]||(l[12]=t=>w.value=t),title:W.value,width:"600px",onClose:ne},{footer:a(()=>[e(i,{onClick:l[11]||(l[11]=t=>w.value=!1)},{default:a(()=>[...l[22]||(l[22]=[m("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:ue,loading:H.value},{default:a(()=>[m(Ve(k.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:a(()=>[e(M,{ref_key:"formRef",ref:L,model:n,rules:Q,"label-width":"100px"},{default:a(()=>[e(c,{label:"开课计划",prop:"courseScheduleId"},{default:a(()=>[e(h,{modelValue:n.courseScheduleId,"onUpdate:modelValue":l[5]||(l[5]=t=>n.courseScheduleId=t),placeholder:"请选择开课计划",onChange:se},{default:a(()=>[(y(!0),E(G,null,J(I.value,t=>(y(),N(o,{key:t.id,label:t.courseName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(P,{gutter:20},{default:a(()=>[e(x,{span:12},{default:a(()=>[e(c,{label:"星期",prop:"weekDay"},{default:a(()=>[e(h,{modelValue:n.weekDay,"onUpdate:modelValue":l[6]||(l[6]=t=>n.weekDay=t),placeholder:"请选择星期"},{default:a(()=>[e(o,{label:"星期一",value:1}),e(o,{label:"星期二",value:2}),e(o,{label:"星期三",value:3}),e(o,{label:"星期四",value:4}),e(o,{label:"星期五",value:5}),e(o,{label:"星期六",value:6}),e(o,{label:"星期日",value:7})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(x,{span:12},{default:a(()=>[e(c,{label:"教室",prop:"classroom"},{default:a(()=>[e(T,{modelValue:n.classroom,"onUpdate:modelValue":l[7]||(l[7]=t=>n.classroom=t),placeholder:"请输入教室"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(P,{gutter:20},{default:a(()=>[e(x,{span:12},{default:a(()=>[e(c,{label:"开始时间",prop:"startTime"},{default:a(()=>[e(D,{modelValue:n.startTime,"onUpdate:modelValue":l[8]||(l[8]=t=>n.startTime=t),format:"HH:mm","value-format":"HH:mm:ss",placeholder:"选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{span:12},{default:a(()=>[e(c,{label:"结束时间",prop:"endTime"},{default:a(()=>[e(D,{modelValue:n.endTime,"onUpdate:modelValue":l[9]||(l[9]=t=>n.endTime=t),format:"HH:mm","value-format":"HH:mm:ss",placeholder:"选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{label:"周次",prop:"weeks"},{default:a(()=>[e(T,{modelValue:n.weeks,"onUpdate:modelValue":l[10]||(l[10]=t=>n.weeks=t),placeholder:"如：1-16周"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(K,{modelValue:V.value,"onUpdate:modelValue":l[14]||(l[14]=t=>V.value=t),title:"批量排课",width:"800px"},{footer:a(()=>[e(i,{onClick:l[13]||(l[13]=t=>V.value=!1)},{default:a(()=>[...l[25]||(l[25]=[m("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:de,loading:B.value},{default:a(()=>[...l[26]||(l[26]=[m(" 批量添加 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(O,{data:C.value,stripe:"",style:{width:"100%"}},{default:a(()=>[e(u,{prop:"courseScheduleId",label:"开课计划",width:"150"},{default:a(({row:t,$index:_})=>[e(h,{modelValue:t.courseScheduleId,"onUpdate:modelValue":r=>t.courseScheduleId=r,placeholder:"请选择"},{default:a(()=>[(y(!0),E(G,null,J(I.value,r=>(y(),N(o,{key:r.id,label:r.courseName,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{prop:"weekDay",label:"星期",width:"100"},{default:a(({row:t,$index:_})=>[e(h,{modelValue:t.weekDay,"onUpdate:modelValue":r=>t.weekDay=r,placeholder:"请选择"},{default:a(()=>[e(o,{label:"星期一",value:1}),e(o,{label:"星期二",value:2}),e(o,{label:"星期三",value:3}),e(o,{label:"星期四",value:4}),e(o,{label:"星期五",value:5}),e(o,{label:"星期六",value:6}),e(o,{label:"星期日",value:7})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{prop:"startTime",label:"开始时间",width:"120"},{default:a(({row:t,$index:_})=>[e(D,{modelValue:t.startTime,"onUpdate:modelValue":r=>t.startTime=r,format:"HH:mm","value-format":"HH:mm:ss",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{prop:"endTime",label:"结束时间",width:"120"},{default:a(({row:t,$index:_})=>[e(D,{modelValue:t.endTime,"onUpdate:modelValue":r=>t.endTime=r,format:"HH:mm","value-format":"HH:mm:ss",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{prop:"classroom",label:"教室",width:"120"},{default:a(({row:t,$index:_})=>[e(T,{modelValue:t.classroom,"onUpdate:modelValue":r=>t.classroom=r,placeholder:"教室"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{prop:"weeks",label:"周次",width:"100"},{default:a(({row:t,$index:_})=>[e(T,{modelValue:t.weeks,"onUpdate:modelValue":r=>t.weeks=r,placeholder:"周次"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{label:"操作",width:"80"},{default:a(({row:t,$index:_})=>[e(i,{type:"danger",size:"small",onClick:r=>oe(_)},{default:a(()=>[...l[23]||(l[23]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),U("div",$e,[e(i,{type:"primary",onClick:te},{default:a(()=>[e(S,null,{default:a(()=>[e(A)]),_:1}),l[24]||(l[24]=m(" 添加行 ",-1))]),_:1})])]),_:1},8,["modelValue"])])}}},Fe=ze(Le,[["__scopeId","data-v-b401f8be"]]);export{Fe as default};
