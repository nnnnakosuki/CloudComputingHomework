import{s as Y,r as b,b as z,j as pe,k as ie,c as s,v as fe,o as O,d as ge,f as e,w as t,E as V,e as D,l as R,h as i,g as ce,x as _e,n as be,t as A,p as ve,A as Ve,B as ye,C as we}from"./index-9b5da449.js";import{_ as Ne}from"./_plugin-vue_export-helper-c27b6911.js";const ke=f=>Y({url:"/students",method:"get",params:f}),Ce=f=>Y({url:"/students",method:"post",data:f}),Se=(f,y)=>Y({url:`/students/${f}`,method:"put",data:y}),Ue=f=>Y({url:`/students/${f}`,method:"delete"}),xe=(f,y)=>Y({url:`/students/${f}/status`,method:"post",data:y});const Ye={class:"student-management"},ze={class:"card-header"},Te={class:"pagination"},Ie={__name:"Students",setup(f){const y=b(!1),T=b(!1),I=b(!1),N=b(!1),k=b(!1),C=b(!1),E=b([]),S=b({}),d=z({current:1,size:10,total:0}),v=z({keyword:"",deptId:null,status:null}),o=z({id:null,studentNo:"",name:"",username:"",password:"",realName:"",gender:null,deptId:null,major:"",className:"",enrollmentYear:null}),g=z({studentId:null,statusType:null,reason:""}),K={studentNo:[{required:!0,message:"请输入学号",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],deptId:[{required:!0,message:"请选择院系",trigger:"change"}],major:[{required:!0,message:"请输入专业",trigger:"blur"}],className:[{required:!0,message:"请输入班级",trigger:"blur"}],enrollmentYear:[{required:!0,message:"请选择入学年份",trigger:"change"}]},P={statusType:[{required:!0,message:"请选择变动类型",trigger:"change"}],reason:[{required:!0,message:"请输入变动原因",trigger:"blur"}]},G=pe(()=>C.value?"编辑学生":"添加学生"),q=b(),h=b(),w=async()=>{y.value=!0;try{const n=await ke({current:d.current,size:d.size,...v});E.value=n.data.records||[],d.total=n.data.total||0}catch{V.error("获取学生列表失败")}finally{y.value=!1}},j=()=>{d.current=1,w()},H=()=>{Object.assign(v,{keyword:"",deptId:null,status:null}),j()},J=()=>{C.value=!1,F(),N.value=!0},Q=n=>{C.value=!0,Object.assign(o,n),N.value=!0},W=async n=>{try{await ve.confirm("确定要删除该学生吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ue(n.id),V.success("删除成功"),w()}catch(l){l!=="cancel"&&V.error("删除失败")}},X=n=>{S.value=n,g.studentId=n.id,g.statusType=null,g.reason="",k.value=!0},Z=async()=>{q.value&&await q.value.validate(async n=>{if(n){T.value=!0;try{const l={...o};l.enrollmentYear&&(l.enrollmentYear=l.enrollmentYear.substring(0,4)),C.value?(await Se(o.id,l),V.success("更新成功")):(await Ce(l),V.success("添加成功")),N.value=!1,w()}catch(l){V.error(l.message||"操作失败")}finally{T.value=!1}}})},ee=async()=>{h.value&&await h.value.validate(async n=>{if(n){I.value=!0;try{await xe(g.studentId,g),V.success("学籍变动处理成功"),k.value=!1,w()}catch(l){V.error(l.message||"操作失败")}finally{I.value=!1}}})},le=()=>{F()},F=()=>{Object.assign(o,{id:null,studentNo:"",name:"",username:"",password:"",realName:"",gender:null,deptId:null,major:"",className:"",enrollmentYear:null})},te=n=>{d.size=n,w()},ae=n=>{d.current=n,w()},oe=n=>{switch(n){case 1:return"success";case 2:return"warning";case 3:return"danger";case 4:return"info";default:return""}};return ie(()=>{w()}),(n,l)=>{const B=s("el-icon"),c=s("el-button"),m=s("el-input"),u=s("el-form-item"),r=s("el-option"),U=s("el-select"),$=s("el-form"),p=s("el-table-column"),ne=s("el-tag"),ue=s("el-table"),se=s("el-pagination"),re=s("el-card"),_=s("el-col"),x=s("el-row"),de=s("el-date-picker"),L=s("el-dialog"),me=fe("loading");return O(),ge("div",Ye,[e(re,null,{header:t(()=>[D("div",ze,[l[24]||(l[24]=D("span",null,"学生管理",-1)),e(c,{type:"primary",onClick:J},{default:t(()=>[e(B,null,{default:t(()=>[e(R(Ve))]),_:1}),l[23]||(l[23]=i(" 添加学生 ",-1))]),_:1})])]),default:t(()=>[e($,{model:v,inline:"",class:"search-form"},{default:t(()=>[e(u,{label:"关键词"},{default:t(()=>[e(m,{modelValue:v.keyword,"onUpdate:modelValue":l[0]||(l[0]=a=>v.keyword=a),placeholder:"请输入学号、姓名或用户名",clearable:"",onKeyup:ce(j,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"院系"},{default:t(()=>[e(U,{modelValue:v.deptId,"onUpdate:modelValue":l[1]||(l[1]=a=>v.deptId=a),placeholder:"请选择院系",clearable:""},{default:t(()=>[e(r,{label:"计算机学院",value:1}),e(r,{label:"软件学院",value:2})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"状态"},{default:t(()=>[e(U,{modelValue:v.status,"onUpdate:modelValue":l[2]||(l[2]=a=>v.status=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(r,{label:"在校",value:1}),e(r,{label:"休学",value:2}),e(r,{label:"退学",value:3}),e(r,{label:"毕业",value:4})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(c,{type:"primary",onClick:j},{default:t(()=>[e(B,null,{default:t(()=>[e(R(ye))]),_:1}),l[25]||(l[25]=i(" 搜索 ",-1))]),_:1}),e(c,{onClick:H},{default:t(()=>[e(B,null,{default:t(()=>[e(R(we))]),_:1}),l[26]||(l[26]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),_e((O(),be(ue,{data:E.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(p,{prop:"studentNo",label:"学号",width:"120"}),e(p,{prop:"name",label:"姓名",width:"100"}),e(p,{prop:"username",label:"用户名",width:"120"}),e(p,{prop:"realName",label:"真实姓名",width:"100"}),e(p,{prop:"genderText",label:"性别",width:"80"}),e(p,{prop:"major",label:"专业",width:"150"}),e(p,{prop:"className",label:"班级",width:"120"}),e(p,{prop:"enrollmentYear",label:"入学年份",width:"100"}),e(p,{prop:"statusText",label:"状态",width:"80"},{default:t(({row:a})=>[e(ne,{type:oe(a.status)},{default:t(()=>[i(A(a.statusText),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"createTime",label:"创建时间",width:"160"}),e(p,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[e(c,{type:"primary",size:"small",onClick:M=>Q(a)},{default:t(()=>[...l[27]||(l[27]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(c,{type:"warning",size:"small",onClick:M=>X(a)},{default:t(()=>[...l[28]||(l[28]=[i(" 学籍变动 ",-1)])]),_:1},8,["onClick"]),e(c,{type:"danger",size:"small",onClick:M=>W(a)},{default:t(()=>[...l[29]||(l[29]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,y.value]]),D("div",Te,[e(se,{"current-page":d.current,"onUpdate:currentPage":l[3]||(l[3]=a=>d.current=a),"page-size":d.size,"onUpdate:pageSize":l[4]||(l[4]=a=>d.size=a),total:d.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1}),e(L,{modelValue:N.value,"onUpdate:modelValue":l[16]||(l[16]=a=>N.value=a),title:G.value,width:"600px",onClose:le},{footer:t(()=>[e(c,{onClick:l[15]||(l[15]=a=>N.value=!1)},{default:t(()=>[...l[30]||(l[30]=[i("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:Z,loading:T.value},{default:t(()=>[i(A(C.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:t(()=>[e($,{ref_key:"formRef",ref:q,model:o,rules:K,"label-width":"100px"},{default:t(()=>[e(x,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(u,{label:"学号",prop:"studentNo"},{default:t(()=>[e(m,{modelValue:o.studentNo,"onUpdate:modelValue":l[5]||(l[5]=a=>o.studentNo=a),placeholder:"请输入学号"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(u,{label:"姓名",prop:"name"},{default:t(()=>[e(m,{modelValue:o.name,"onUpdate:modelValue":l[6]||(l[6]=a=>o.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(u,{label:"用户名",prop:"username"},{default:t(()=>[e(m,{modelValue:o.username,"onUpdate:modelValue":l[7]||(l[7]=a=>o.username=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(u,{label:"密码",prop:"password"},{default:t(()=>[e(m,{modelValue:o.password,"onUpdate:modelValue":l[8]||(l[8]=a=>o.password=a),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(u,{label:"真实姓名",prop:"realName"},{default:t(()=>[e(m,{modelValue:o.realName,"onUpdate:modelValue":l[9]||(l[9]=a=>o.realName=a),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(u,{label:"性别",prop:"gender"},{default:t(()=>[e(U,{modelValue:o.gender,"onUpdate:modelValue":l[10]||(l[10]=a=>o.gender=a),placeholder:"请选择性别"},{default:t(()=>[e(r,{label:"男",value:1}),e(r,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(u,{label:"院系",prop:"deptId"},{default:t(()=>[e(U,{modelValue:o.deptId,"onUpdate:modelValue":l[11]||(l[11]=a=>o.deptId=a),placeholder:"请选择院系"},{default:t(()=>[e(r,{label:"计算机学院",value:1}),e(r,{label:"软件学院",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(u,{label:"专业",prop:"major"},{default:t(()=>[e(m,{modelValue:o.major,"onUpdate:modelValue":l[12]||(l[12]=a=>o.major=a),placeholder:"请输入专业"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(u,{label:"班级",prop:"className"},{default:t(()=>[e(m,{modelValue:o.className,"onUpdate:modelValue":l[13]||(l[13]=a=>o.className=a),placeholder:"请输入班级"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(u,{label:"入学年份",prop:"enrollmentYear"},{default:t(()=>[e(de,{modelValue:o.enrollmentYear,"onUpdate:modelValue":l[14]||(l[14]=a=>o.enrollmentYear=a),type:"year",placeholder:"请选择入学年份",format:"YYYY","value-format":"YYYY"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(L,{modelValue:k.value,"onUpdate:modelValue":l[22]||(l[22]=a=>k.value=a),title:"学籍变动",width:"500px"},{footer:t(()=>[e(c,{onClick:l[21]||(l[21]=a=>k.value=!1)},{default:t(()=>[...l[31]||(l[31]=[i("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:ee,loading:I.value},{default:t(()=>[...l[32]||(l[32]=[i(" 确认变动 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e($,{ref_key:"statusFormRef",ref:h,model:g,rules:P,"label-width":"100px"},{default:t(()=>[e(u,{label:"学生姓名"},{default:t(()=>[e(m,{modelValue:S.value.name,"onUpdate:modelValue":l[17]||(l[17]=a=>S.value.name=a),disabled:""},null,8,["modelValue"])]),_:1}),e(u,{label:"学号"},{default:t(()=>[e(m,{modelValue:S.value.studentNo,"onUpdate:modelValue":l[18]||(l[18]=a=>S.value.studentNo=a),disabled:""},null,8,["modelValue"])]),_:1}),e(u,{label:"变动类型",prop:"statusType"},{default:t(()=>[e(U,{modelValue:g.statusType,"onUpdate:modelValue":l[19]||(l[19]=a=>g.statusType=a),placeholder:"请选择变动类型"},{default:t(()=>[e(r,{label:"注册",value:1}),e(r,{label:"转学",value:2}),e(r,{label:"毕业",value:3}),e(r,{label:"休学",value:4}),e(r,{label:"退学",value:5})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"变动原因",prop:"reason"},{default:t(()=>[e(m,{modelValue:g.reason,"onUpdate:modelValue":l[20]||(l[20]=a=>g.reason=a),type:"textarea",rows:3,placeholder:"请输入变动原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},je=Ne(Ie,[["__scopeId","data-v-2013dd55"]]);export{je as default};
