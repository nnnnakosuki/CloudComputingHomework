import{a as q,r as y,b as G,j as H,k as J,c as n,v as O,o as u,d as P,f as e,w as l,E as i,e as b,h as d,g as Q,x as I,n as p,t as f,p as M}from"./index-9b5da449.js";import{g as W}from"./courseSchedule-2f0830e1.js";import{g as X,s as Y,d as Z}from"./courseSelection-a3ee75e2.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";const te={class:"course-selection"},le={class:"card-header"},se={__name:"Courses",setup(ae){const z=q(),h=y(!1),v=y(!1),k=y([]),w=y([]),r=G({semester:"2024春季",courseType:null,keyword:""}),E=H(()=>{let a=k.value;return r.courseType!==null&&(a=a.filter(t=>t.courseType===r.courseType)),r.keyword&&(a=a.filter(t=>t.courseName.includes(r.keyword)||t.courseCode.includes(r.keyword))),a}),m=async()=>{if(r.semester){h.value=!0;try{const a=z.userInfo.id,t=await W(a,r.semester);k.value=t.data||[]}catch{i.error("获取可选课程失败")}finally{h.value=!1}}},g=async()=>{v.value=!0;try{const a=await X(r.semester);w.value=a.data||[]}catch{i.error("获取我的选课失败")}finally{v.value=!1}},x=()=>{m()},U=async a=>{try{await M.confirm(`确定要选择课程"${a.courseName}"吗？`,"确认选课",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t={courseScheduleId:a.id};await Y(t),i.success("选课成功"),m(),g()}catch(t){t!=="cancel"&&i.error("选课失败")}},$=async a=>{try{await M.confirm(`确定要退选课程"${a.courseName}"吗？`,"确认退课",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Z(a.id),i.success("退课成功"),m(),g()}catch(t){t!=="cancel"&&i.error("退课失败")}},S=a=>w.value.some(t=>t.courseScheduleId===a),A=a=>{switch(a){case 1:return"warning";case 2:return"success";case 3:return"danger";default:return"info"}};return J(()=>{m(),g()}),(a,t)=>{const F=n("Refresh"),K=n("el-icon"),_=n("el-button"),c=n("el-option"),V=n("el-select"),C=n("el-form-item"),R=n("el-input"),j=n("el-form"),o=n("el-table-column"),T=n("el-tag"),N=n("el-table"),B=n("el-card"),D=O("loading");return u(),P("div",te,[e(B,null,{header:l(()=>[b("div",le,[t[4]||(t[4]=b("span",null,"课程浏览与选课",-1)),e(_,{onClick:m},{default:l(()=>[e(K,null,{default:l(()=>[e(F)]),_:1}),t[3]||(t[3]=d(" 刷新 ",-1))]),_:1})])]),default:l(()=>[e(j,{model:r,inline:"",class:"filter-form"},{default:l(()=>[e(C,{label:"学期"},{default:l(()=>[e(V,{modelValue:r.semester,"onUpdate:modelValue":t[0]||(t[0]=s=>r.semester=s),placeholder:"请选择学期",onChange:x,style:{width:"150px"}},{default:l(()=>[e(c,{label:"2024春季",value:"2024春季"}),e(c,{label:"2023秋季",value:"2023秋季"}),e(c,{label:"2023春季",value:"2023春季"})]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"课程类型"},{default:l(()=>[e(V,{modelValue:r.courseType,"onUpdate:modelValue":t[1]||(t[1]=s=>r.courseType=s),placeholder:"请选择课程类型",onChange:x,style:{width:"150px"}},{default:l(()=>[e(c,{label:"全部",value:null}),e(c,{label:"必修",value:1}),e(c,{label:"选修",value:2})]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"关键词"},{default:l(()=>[e(R,{modelValue:r.keyword,"onUpdate:modelValue":t[2]||(t[2]=s=>r.keyword=s),placeholder:"请输入课程名称",clearable:"",onKeyup:Q(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),I((u(),p(N,{data:E.value,stripe:"",style:{width:"100%"}},{default:l(()=>[e(o,{prop:"courseCode",label:"课程编号",width:"120"}),e(o,{prop:"courseName",label:"课程名称",width:"200"}),e(o,{prop:"credits",label:"学分",width:"80"}),e(o,{prop:"courseTypeText",label:"课程类型",width:"100"},{default:l(({row:s})=>[e(T,{type:s.courseType===1?"primary":"success"},{default:l(()=>[d(f(s.courseTypeText),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"semester",label:"学期",width:"120"}),e(o,{prop:"teacherName",label:"任课教师",width:"100"}),e(o,{prop:"maxStudents",label:"容量",width:"80"}),e(o,{prop:"currentStudents",label:"已选",width:"80"}),e(o,{prop:"statusText",label:"状态",width:"100"},{default:l(({row:s})=>[e(T,{type:s.status===1?"success":"danger"},{default:l(()=>[d(f(s.statusText),1)]),_:2},1032,["type"])]),_:1}),e(o,{label:"操作",width:"120",fixed:"right"},{default:l(({row:s})=>[s.status===1&&s.currentStudents<s.maxStudents?(u(),p(_,{key:0,type:"primary",size:"small",onClick:L=>U(s),disabled:S(s.id)},{default:l(()=>[d(f(S(s.id)?"已选择":"选择"),1)]),_:2},1032,["onClick","disabled"])):(u(),p(_,{key:1,type:"info",size:"small",disabled:""},{default:l(()=>[d(f(s.status!==1?"未开放":"已满"),1)]),_:2},1024))]),_:1})]),_:1},8,["data"])),[[D,h.value]])]),_:1}),e(B,{style:{"margin-top":"20px"}},{header:l(()=>[...t[5]||(t[5]=[b("div",{class:"card-header"},[b("span",null,"我的选课")],-1)])]),default:l(()=>[I((u(),p(N,{data:w.value,stripe:"",style:{width:"100%"}},{default:l(()=>[e(o,{prop:"courseCode",label:"课程编号",width:"120"}),e(o,{prop:"courseName",label:"课程名称",width:"200"}),e(o,{prop:"credits",label:"学分",width:"80"}),e(o,{prop:"semester",label:"学期",width:"120"}),e(o,{prop:"teacherName",label:"任课教师",width:"100"}),e(o,{prop:"statusText",label:"状态",width:"100"},{default:l(({row:s})=>[e(T,{type:A(s.status)},{default:l(()=>[d(f(s.statusText),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"selectTime",label:"选课时间",width:"160"}),e(o,{label:"操作",width:"120",fixed:"right"},{default:l(({row:s})=>[s.status===1?(u(),p(_,{key:0,type:"danger",size:"small",onClick:L=>$(s)},{default:l(()=>[...t[6]||(t[6]=[d(" 退课 ",-1)])]),_:1},8,["onClick"])):(u(),p(_,{key:1,type:"info",size:"small",disabled:""},{default:l(()=>[...t[7]||(t[7]=[d(" 已确认 ",-1)])]),_:1}))]),_:1})]),_:1},8,["data"])),[[D,v.value]])]),_:1})])}}},ue=ee(se,[["__scopeId","data-v-ab3b2d9f"]]);export{ue as default};
